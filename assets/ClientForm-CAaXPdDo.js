import{an as B,ao as I,aq as S,c as r,a,g as u,ar as o,K as _,v as c,ak as D,D as g,j as k,as as E,au as $,r as f,o as d,at as U}from"./index-CCGZToX-.js";import{u as j,f as z,s as V,b as F,e as M}from"./_plugin-vue_export-helper-PB70KR25.js";const O={class:"page"},R={class:"page-header"},T={class:"form-card"},W={class:"form-header"},A={class:"form-title"},K={class:"form-subtitle"},L={key:0,class:"loading"},P={class:"form-grid"},G={class:"field"},H={key:0,class:"field-error"},J={class:"field"},Q={key:0,class:"field-error"},Y={class:"field"},Z={key:0,class:"field-error"},ee={class:"field"},le={class:"form-footer"},ae=B({__name:"ClientForm",setup(se){const v=E(),C=U(),h=j(),p=I(),m=$(()=>C.name==="client-edit"),X=$(()=>Number(C.params.id)),s=f({name:"",email:"",phone:"",status:"new"}),i=f({}),b=f(!1),y=f(!1),w=[{label:"Новый",value:"new"},{label:"Активный",value:"active"},{label:"Заблокирован",value:"blocked"}];function x(t){let e=t.target.value.replace(/\D/g,"");e.startsWith("8")&&(e="7"+e.slice(1)),e.startsWith("7")?e=e.slice(0,11):e=e.slice(0,10);let n="";e.length>0&&(n="+7"),e.length>1&&(n+=` (${e.slice(1,4)}`),e.length>=4&&(n+=")"),e.length>4&&(n+=` ${e.slice(4,7)}`),e.length>7&&(n+=`-${e.slice(7,9)}`),e.length>9&&(n+=`-${e.slice(9,11)}`),s.value.phone=n}function N(){const t={};return s.value.name.trim()||(t.name="Введите имя клиента"),s.value.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.value.email)||(t.email="Некорректный формат email"):t.email="Введите email",s.value.phone.trim()?/^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/.test(s.value.phone)||(t.phone="Введите полный номер: +7 (XXX) XXX-XX-XX"):t.phone="Введите номер телефона",i.value=t,Object.keys(t).length===0}async function q(){if(N()){b.value=!0;try{m.value?(await h.updateClient(X.value,s.value),p.add({severity:"success",summary:"Сохранено",detail:"Данные клиента обновлены",life:3e3})):(await h.createClient(s.value),p.add({severity:"success",summary:"Создано",detail:"Новый клиент добавлен",life:3e3})),v.push({name:"clients"})}catch{p.add({severity:"error",summary:"Ошибка",detail:h.error||"Что-то пошло не так",life:5e3})}finally{b.value=!1}}}return S(async()=>{if(m.value){y.value=!0;const t=await z.getById(X.value);t?s.value={name:t.name,email:t.email,phone:t.phone,status:t.status}:(p.add({severity:"error",summary:"Ошибка",detail:"Клиент не найден",life:5e3}),v.push({name:"clients"})),y.value=!1}}),(t,l)=>(d(),r("div",O,[a("div",R,[u(o(_),{icon:"pi pi-arrow-left",label:"Назад",text:"",size:"small",onClick:l[0]||(l[0]=e=>o(v).push({name:"clients"})),class:"back-btn"})]),a("div",T,[a("div",W,[a("h1",A,c(m.value?"Редактирование":"Новый клиент"),1),a("p",K,c(m.value?"Измените данные клиента":"Заполните информацию о клиенте"),1)]),y.value?(d(),r("div",L,[...l[5]||(l[5]=[a("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"1.5rem",color:"#94a3b8"}},null,-1),a("span",null,"Загрузка данных...",-1)])])):(d(),r("form",{key:1,onSubmit:D(q,["prevent"]),class:"form"},[a("div",P,[a("div",G,[l[6]||(l[6]=a("label",{for:"name"},[g("Имя "),a("span",{class:"required"},"*")],-1)),u(o(V),{id:"name",modelValue:s.value.name,"onUpdate:modelValue":l[1]||(l[1]=e=>s.value.name=e),invalid:!!i.value.name,placeholder:"Иван Петров"},null,8,["modelValue","invalid"]),i.value.name?(d(),r("small",H,c(i.value.name),1)):k("",!0)]),a("div",J,[l[7]||(l[7]=a("label",{for:"email"},[g("Email "),a("span",{class:"required"},"*")],-1)),u(o(V),{id:"email",modelValue:s.value.email,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value.email=e),invalid:!!i.value.email,placeholder:"ivan@example.com"},null,8,["modelValue","invalid"]),i.value.email?(d(),r("small",Q,c(i.value.email),1)):k("",!0)]),a("div",Y,[l[8]||(l[8]=a("label",{for:"phone"},[g("Телефон "),a("span",{class:"required"},"*")],-1)),u(o(V),{id:"phone",value:s.value.phone,onInput:x,invalid:!!i.value.phone,placeholder:"+7 (900) 123-45-67"},null,8,["value","invalid"]),i.value.phone?(d(),r("small",Z,c(i.value.phone),1)):k("",!0)]),a("div",ee,[l[9]||(l[9]=a("label",{for:"status"},"Статус",-1)),u(o(F),{id:"status",modelValue:s.value.status,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.status=e),options:w,optionLabel:"label",optionValue:"value"},null,8,["modelValue"])])]),a("div",le,[u(o(_),{type:"button",label:"Отмена",severity:"secondary",outlined:"",onClick:l[4]||(l[4]=e=>o(v).push({name:"clients"}))}),u(o(_),{type:"submit",label:m.value?"Сохранить изменения":"Создать клиента",loading:b.value,icon:"pi pi-check"},null,8,["label","loading"])])],32))])]))}}),oe=M(ae,[["__scopeId","data-v-e97d6324"]]);export{oe as default};

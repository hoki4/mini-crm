import{an as q,ao as B,aq as S,c as u,a,g as n,ar as o,K as h,v as m,ak as U,D as _,j as V,as as E,au as w,r as c,o as r,at as I}from"./index-DxI5smGy.js";import{u as j,f as z,s as k,b as D,e as F}from"./_plugin-vue_export-helper-DssW2R7N.js";const M={class:"page"},O={class:"page-header"},R={class:"form-card"},T={class:"form-header"},A={class:"form-title"},K={class:"form-subtitle"},L={key:0,class:"loading"},G={class:"form-grid"},H={class:"field"},J={key:0,class:"field-error"},P={class:"field"},Q={key:0,class:"field-error"},W={class:"field"},X={key:0,class:"field-error"},Y={class:"field"},Z={class:"form-footer"},ee=q({__name:"ClientForm",setup(ae){const v=E(),g=I(),f=j(),p=B(),d=w(()=>g.name==="client-edit"),C=w(()=>Number(g.params.id)),l=c({name:"",email:"",phone:"",status:"new"}),t=c({}),b=c(!1),y=c(!1),x=[{label:"Новый",value:"new"},{label:"Активный",value:"active"},{label:"Заблокирован",value:"blocked"}];function $(){const s={};return l.value.name.trim()||(s.name="Введите имя клиента"),l.value.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.value.email)||(s.email="Некорректный формат email"):s.email="Введите email",l.value.phone.trim()?/^\+?[\d\s().-]{7,}$/.test(l.value.phone)||(s.phone="Некорректный формат телефона"):s.phone="Введите номер телефона",t.value=s,Object.keys(s).length===0}async function N(){if($()){b.value=!0;try{d.value?(await f.updateClient(C.value,l.value),p.add({severity:"success",summary:"Сохранено",detail:"Данные клиента обновлены",life:3e3})):(await f.createClient(l.value),p.add({severity:"success",summary:"Создано",detail:"Новый клиент добавлен",life:3e3})),v.push({name:"clients"})}catch{p.add({severity:"error",summary:"Ошибка",detail:f.error||"Что-то пошло не так",life:5e3})}finally{b.value=!1}}}return S(async()=>{if(d.value){y.value=!0;const s=await z.getById(C.value);s?l.value={name:s.name,email:s.email,phone:s.phone,status:s.status}:(p.add({severity:"error",summary:"Ошибка",detail:"Клиент не найден",life:5e3}),v.push({name:"clients"})),y.value=!1}}),(s,e)=>(r(),u("div",M,[a("div",O,[n(o(h),{icon:"pi pi-arrow-left",label:"Назад",text:"",size:"small",onClick:e[0]||(e[0]=i=>o(v).push({name:"clients"})),class:"back-btn"})]),a("div",R,[a("div",T,[a("h1",A,m(d.value?"Редактирование":"Новый клиент"),1),a("p",K,m(d.value?"Измените данные клиента":"Заполните информацию о клиенте"),1)]),y.value?(r(),u("div",L,[...e[6]||(e[6]=[a("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"1.5rem",color:"#94a3b8"}},null,-1),a("span",null,"Загрузка данных...",-1)])])):(r(),u("form",{key:1,onSubmit:U(N,["prevent"]),class:"form"},[a("div",G,[a("div",H,[e[7]||(e[7]=a("label",{for:"name"},[_("Имя "),a("span",{class:"required"},"*")],-1)),n(o(k),{id:"name",modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=i=>l.value.name=i),invalid:!!t.value.name,placeholder:"Иван Петров"},null,8,["modelValue","invalid"]),t.value.name?(r(),u("small",J,m(t.value.name),1)):V("",!0)]),a("div",P,[e[8]||(e[8]=a("label",{for:"email"},[_("Email "),a("span",{class:"required"},"*")],-1)),n(o(k),{id:"email",modelValue:l.value.email,"onUpdate:modelValue":e[2]||(e[2]=i=>l.value.email=i),invalid:!!t.value.email,placeholder:"ivan@example.com"},null,8,["modelValue","invalid"]),t.value.email?(r(),u("small",Q,m(t.value.email),1)):V("",!0)]),a("div",W,[e[9]||(e[9]=a("label",{for:"phone"},[_("Телефон "),a("span",{class:"required"},"*")],-1)),n(o(k),{id:"phone",modelValue:l.value.phone,"onUpdate:modelValue":e[3]||(e[3]=i=>l.value.phone=i),invalid:!!t.value.phone,placeholder:"+7 (900) 123-45-67"},null,8,["modelValue","invalid"]),t.value.phone?(r(),u("small",X,m(t.value.phone),1)):V("",!0)]),a("div",Y,[e[10]||(e[10]=a("label",{for:"status"},"Статус",-1)),n(o(D),{id:"status",modelValue:l.value.status,"onUpdate:modelValue":e[4]||(e[4]=i=>l.value.status=i),options:x,optionLabel:"label",optionValue:"value"},null,8,["modelValue"])])]),a("div",Z,[n(o(h),{type:"button",label:"Отмена",severity:"secondary",outlined:"",onClick:e[5]||(e[5]=i=>o(v).push({name:"clients"}))}),n(o(h),{type:"submit",label:d.value?"Сохранить изменения":"Создать клиента",loading:b.value,icon:"pi pi-check"},null,8,["label","loading"])])],32))])]))}}),te=F(ee,[["__scopeId","data-v-2d450e14"]]);export{te as default};
